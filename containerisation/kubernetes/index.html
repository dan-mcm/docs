



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="https://lh3.googleusercontent.com/m2Zy-ujFWYyQUhg3uIuG_YDx00HB1v08cQ4CBJnd-v6LMPBpps3C4kvQriV0nObfI-I">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Kubernetes - Dans Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="cyan">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#kubernetes" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Dans Docs" class="md-header-nav__button md-logo">
          
            <img src="https://lh3.googleusercontent.com/m2Zy-ujFWYyQUhg3uIuG_YDx00HB1v08cQ4CBJnd-v6LMPBpps3C4kvQriV0nObfI-I" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Dans Docs
            </span>
            <span class="md-header-nav__topic">
              
                Kubernetes
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/daniel40392/docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Dan's Docs
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../languages/python/" class="md-tabs__link">
          Languages
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../docker/" class="md-tabs__link md-tabs__link--active">
          Containerisation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../aws/aws/" class="md-tabs__link">
          AWS
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Dans Docs" class="md-nav__button md-logo">
      
        <img src="https://lh3.googleusercontent.com/m2Zy-ujFWYyQUhg3uIuG_YDx00HB1v08cQ4CBJnd-v6LMPBpps3C4kvQriV0nObfI-I" width="48" height="48">
      
    </a>
    Dans Docs
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/daniel40392/docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Dan's Docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../publications/dev/" title="Publications" class="md-nav__link">
      Publications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Languages
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Languages
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../languages/python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../languages/javascript/" title="JavaScript" class="md-nav__link">
      JavaScript
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../languages/java/" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../languages/scala/" title="Scala" class="md-nav__link">
      Scala
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../languages/go/" title="Go" class="md-nav__link">
      Go
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Containerisation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Containerisation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../docker/" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Kubernetes
      </label>
    
    <a href="./" title="Kubernetes" class="md-nav__link md-nav__link--active">
      Kubernetes
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vagrant-commands" class="md-nav__link">
    Vagrant Commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-docker-container-on-kubernetes" class="md-nav__link">
    Running Docker Container on Kubernetes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-application-on-kubernetes" class="md-nav__link">
    Setup Application on Kubernetes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#useful-kubectl-commands-tie-in-with-above-example" class="md-nav__link">
    Useful Kubectl Commands (tie in with above example)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kops-cluster-deployment" class="md-nav__link">
    Kops Cluster Deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#horizontal-v-vertical-scaling" class="md-nav__link">
    Horizontal -v- Vertical Scaling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-pod-commands" class="md-nav__link">
    Useful Pod Commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-deployment-commands" class="md-nav__link">
    Useful Deployment Commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-service-commands" class="md-nav__link">
    Useful Service Commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#labels" class="md-nav__link">
    Labels
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node-labels" class="md-nav__link">
    Node labels
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#health-checks" class="md-nav__link">
    Health Checks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#readiness-probes" class="md-nav__link">
    Readiness Probes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pod-state" class="md-nav__link">
    Pod State
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secrets" class="md-nav__link">
    Secrets
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-secrets" class="md-nav__link">
    Using Secrets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-ui" class="md-nav__link">
    Web UI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-dashboard" class="md-nav__link">
    Start dashboard
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-user" class="md-nav__link">
    Create user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-login-token" class="md-nav__link">
    Get login token:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#login-to-dashboard" class="md-nav__link">
    Login to dashboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      AWS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        AWS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/aws/" title="AWS" class="md-nav__link">
      AWS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/cli/" title="CLI" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/iam/" title="IAM" class="md-nav__link">
      IAM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/ec2/" title="EC2" class="md-nav__link">
      EC2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/rds/" title="RDS" class="md-nav__link">
      RDS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/elb/" title="ELB" class="md-nav__link">
      ELB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/r53/" title="Route 53" class="md-nav__link">
      Route 53
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/elasticache/" title="Elasticache" class="md-nav__link">
      Elasticache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/dynamo/" title="Dynamo DB" class="md-nav__link">
      Dynamo DB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/dax/" title="Dax" class="md-nav__link">
      Dax
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/kms/" title="KMS" class="md-nav__link">
      KMS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/cloudwatch/" title="CloudWatch" class="md-nav__link">
      CloudWatch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/s3/" title="S3" class="md-nav__link">
      S3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/cloudfront/" title="CloudFront" class="md-nav__link">
      CloudFront
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/serverless/" title="Serverless" class="md-nav__link">
      Serverless
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/lambda/" title="Lambda" class="md-nav__link">
      Lambda
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/api-gateway/" title="API Gateway" class="md-nav__link">
      API Gateway
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/step-functions/" title="Step Functions" class="md-nav__link">
      Step Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/x-ray/" title="X Ray" class="md-nav__link">
      X Ray
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/sqs/" title="SQS" class="md-nav__link">
      SQS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/sns/" title="SNS" class="md-nav__link">
      SNS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/ses/" title="SES" class="md-nav__link">
      SES
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/elasticbeanstalk/" title="Elastic Beanstalk" class="md-nav__link">
      Elastic Beanstalk
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/kinesis/" title="Kinesis" class="md-nav__link">
      Kinesis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/ci-cd/" title="CI/CD" class="md-nav__link">
      CI/CD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/codecommit/" title="CodeCommit" class="md-nav__link">
      CodeCommit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/codedeploy/" title="CodeDeploy" class="md-nav__link">
      CodeDeploy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/codebuild/" title="CodeBuild" class="md-nav__link">
      CodeBuild
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/cloudformation/" title="CloudFormation" class="md-nav__link">
      CloudFormation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/sam/" title="SAM" class="md-nav__link">
      SAM
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vagrant-commands" class="md-nav__link">
    Vagrant Commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-docker-container-on-kubernetes" class="md-nav__link">
    Running Docker Container on Kubernetes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-application-on-kubernetes" class="md-nav__link">
    Setup Application on Kubernetes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#useful-kubectl-commands-tie-in-with-above-example" class="md-nav__link">
    Useful Kubectl Commands (tie in with above example)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kops-cluster-deployment" class="md-nav__link">
    Kops Cluster Deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#horizontal-v-vertical-scaling" class="md-nav__link">
    Horizontal -v- Vertical Scaling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-pod-commands" class="md-nav__link">
    Useful Pod Commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-deployment-commands" class="md-nav__link">
    Useful Deployment Commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-service-commands" class="md-nav__link">
    Useful Service Commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#labels" class="md-nav__link">
    Labels
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node-labels" class="md-nav__link">
    Node labels
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#health-checks" class="md-nav__link">
    Health Checks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#readiness-probes" class="md-nav__link">
    Readiness Probes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pod-state" class="md-nav__link">
    Pod State
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secrets" class="md-nav__link">
    Secrets
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-secrets" class="md-nav__link">
    Using Secrets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-ui" class="md-nav__link">
    Web UI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-dashboard" class="md-nav__link">
    Start dashboard
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-user" class="md-nav__link">
    Create user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-login-token" class="md-nav__link">
    Get login token:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#login-to-dashboard" class="md-nav__link">
    Login to dashboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/daniel40392/docs/edit/master/docs/containerisation/kubernetes.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="kubernetes">Kubernetes</h1>
<p>Notes based on practice following the Udemy course: <a href="https://www.udemy.com/learn-devops-the-complete-kubernetes-course/">Learn DevOps: The Complete Kubernetes Course</a>.</p>
<p>See related GitHub code files <a href="https://github.com/wardviaene/kubernetes-course">here</a>.</p>
<p align="center">
  <img src="https://media.giphy.com/media/991T0LFIrKGfS/giphy.gif"/>
</p>

<h2 id="vagrant-commands">Vagrant Commands</h2>
<p>To build a plain ubuntu box
<div class="highlight"><pre><span></span>mkdir ubuntu
vagrant init ubuntu/xenial64
vagrant up
</pre></div></p>
<h2 id="running-docker-container-on-kubernetes">Running Docker Container on Kubernetes</h2>
<ul>
<li>Before launching container based on Docker image need to create pod definition</li>
<li>Pod: describes an application running on Kubernetes</li>
<li>Service: contain one or more tightly coupled containers (that make up the app - easily communicate with local port numbers)</li>
</ul>
<h3 id="setup-application-on-kubernetes">Setup Application on Kubernetes</h3>
<ul>
<li><code>kubectl create -f k8s/demopod-helloworld.yml</code></li>
<li><code>kubectl describe pod nodehelloworld.example.com</code></li>
<li><code>kubectl port-forward nodehelloworld.example.com 8081:3000</code></li>
<li><code>kubectl expose pod nodehelloworld.example.com --type=NodePort --name=helloworld-service</code></li>
<li><code>minikube service helloworld-service --url</code> returns url of the service running
= <code>kubectl get service</code></li>
</ul>
<h3 id="useful-kubectl-commands-tie-in-with-above-example">Useful Kubectl Commands (tie in with above example)</h3>
<ul>
<li><code>kubectl attach helloworld.example.com</code></li>
<li><code>kubectl exec helloworld.example.com -- ls /app</code> lists file running inside container</li>
<li><code>kubectl exec helloworld.example.com -- touch /app/test.txt</code> creates file inside container  (will disappear if the container is killed - non-persistent data)</li>
<li><code>kubectl describe service helloworld-service</code></li>
<li><code>kubectl run -i -tty busybox --image=busybox --restart=Never -- sh</code></li>
</ul>
<h2 id="kops-cluster-deployment">Kops Cluster Deployment</h2>
<p>AFTER SSHING INTO LINUX INSTANCE (vagrant via putty):</p>
<p><em>setup awscli</em>
<div class="highlight"><pre><span></span>sudo apt-get install python-pip
sudo pip install awscli
aws configure <span class="o">(</span>use IAM role details - with admin policy<span class="o">)</span>
ls -ahl ~/.aws/ <span class="o">(</span>verify credentials<span class="o">)</span>
</pre></div></p>
<p><em>setup kubectl</em>
<div class="highlight"><pre><span></span>wget https://storage.googleapis.com/kubernetes-release/release/v1.6.1/bin/linux/amd64/kubectl
sudo mv kubectl /usr/local/bin/
sudo chmod +x /usr/local/bin/kubectl
kubectl
</pre></div></p>
<p><em>setup keygen</em>
<div class="highlight"><pre><span></span>ssh-keygen -f .ssh/id_rsa
cat .ssh/id_rsa.pub
</pre></div></p>
<p><em>rename kops installation</em>
<code>sudo mv /usr/local/bin/kops-linux-amd64 /usr/local/bin/kops</code></p>
<p><em>generate cluster with your s3 bucket with route53 dns zone</em>
<code>kops create cluster --name=kubernetes.yourowndomain.com --state=s3://kops-state-randomhash --zones=eu-west-1a --node-count=2 --node-size=t2.micro --master-size=t2.micro --dns-zone=kubernetes.yourowndomain.com</code></p>
<p><code>kops update cluster kubernetes.yourowndomain.com --yes --state=s3://kops-state-randomhash</code></p>
<p><em>check your cert and password to log into new cluster</em>
<code>cat .kube/config</code></p>
<p><em>check nodes are running</em>
<code>kubectl get node</code></p>
<p><em>test own program on nodes</em>
<div class="highlight"><pre><span></span>kubectl run hello-minikube --image<span class="o">=</span>gcr.io/google_containers/echoserver:1.4 --port<span class="o">=</span><span class="m">8080</span>
kubectl expose deployment hello-minikube --type<span class="o">=</span>NodePort
kubectl get service
</pre></div></p>
<p>at this point add custom rule to aws- using VPC dashbaord - select master node - modify inbound traffic - all allowed on the port of your app in this case: 31956
Test it out: <a href="http://api.kubernetes.yourowndomain.com:31956/">http://api.kubernetes.yourowndomain.com:31956/</a></p>
<p><em>to delete and avoid payments</em>
<code>kops delete cluster --name kubernetes.yourowndomain.com --state=s3://kops-state-randomhash</code></p>
<p><em>to agree to delete</em>
<code>kops delete cluster --name kubernetes.yourowndomain.com --state=s3://kops-state-randomhash --yes</code></p>
<h2 id="horizontal-v-vertical-scaling">Horizontal -v- Vertical Scaling</h2>
<p>You can only horizontally scale when your pod is stateless. (i.e. kubectl scale options).
Stateful pods cannot be horizontally scaled.</p>
<h2 id="useful-pod-commands">Useful Pod Commands</h2>
<ul>
<li><code>kubectl get pod</code> Get info about all running pods</li>
<li><code>kubectl describe pod &lt;pod&gt;</code> Describe one pod</li>
<li><code>kubectl expose pod &lt;pod&gt; --port=444 --name=frontend</code> Expose port of a pod (creates new service)</li>
<li><code>kubectl port-forward &lt;pod&gt; 8080</code> Port forward teh exposed pod port to your local machine</li>
<li><code>kubectl attach &lt;podname&gt; -i</code> Attach to the pod</li>
<li><code>kubectl exec &lt;pod&gt; --command</code> Execute a command on the pod</li>
<li><code>kubectl label pods &lt;pod&gt; mylabel=awesome</code> Add a new label to a pod</li>
<li><code>kubectl run -i --tty busybox --image=busybox --restart=Never -- sh</code> Run a shell in a pod - very useful for debugging. Once in you can run <code>telnet 172.17.0.5 3000</code> to hit service and then command <code>GET /</code></li>
<li><code>kubectl scale --replicas=4 -f file.yaml</code> Scales the number of pods replicated</li>
<li><code>kubectl get rc</code> Gets replica controllers</li>
<li><code>kubectl scale --replicas=4 -f rc/helloworld-controller</code> Scales the number of pods replicated</li>
<li><code>kubectl delete rc/helloworld-controller</code> Deletes controller</li>
</ul>
<h2 id="useful-deployment-commands">Useful Deployment Commands</h2>
<ul>
<li><code>kubectl get deployments</code></li>
<li><code>kubectl get rs</code></li>
<li><code>kubectl get pods --show-labels</code></li>
<li><code>kubectl rollout status deployment/helloworld-deployment</code></li>
<li><code>kubectl set image deployment/helloworld-deployment k8s-demo=k8s-demo:2</code> can be used to update app to latest version</li>
<li><code>kubectl edit deployment/helloworld-deployment</code></li>
<li><code>kubectl rollout history deployment/helloworld-deployment</code></li>
<li><code>kubectl rollout undo deployment/helloworld-deployment --to-revision=n</code></li>
</ul>
<h2 id="useful-service-commands">Useful Service Commands</h2>
<ul>
<li>ClusterIP - virtual IP address only reachable from within the Cluster (default)</li>
<li>NodePort - same on each node also reachable externally</li>
<li>LoadBalancer - routes external traffic to every node on the NodePort (ELB on AWS)</li>
<li>ExternalName can provide a DNS name for service (e.g. service discovery using DNS) - only works when DNS add-on is enabled</li>
<li>
<p>By default service can only run between ports 30000-32767 but can be changed by adding &ndash;service-node-port-range= argument to kube-apiserver</p>
</li>
<li>
<p><code>minikube service service-name --url</code></p>
</li>
<li><code>kubectl describe svc helloworld-service</code></li>
<li><code>kubectl get svc</code> svc short for service</li>
</ul>
<h2 id="labels">Labels</h2>
<ul>
<li>key/value pairs attached to objects</li>
<li>labels are not unique, multiple can be added to one objects</li>
<li>Label selectors - you can use matching expressions to match labels</li>
<li><code>kubectl get nodes --show-labels</code></li>
</ul>
<h3 id="node-labels">Node labels</h3>
<ul>
<li>You can also use labels to tag nodes - once tagged you can use label selectors to let pods only run on specific nodes</li>
<li>2 steps to run a pod on a specific set of nodes:</li>
<li>First you tag the node</li>
<li>Then you add a nodeSelector to your pod configuration</li>
</ul>
<p>First step: add a label or multiple to your nodes:
<div class="highlight"><pre><span></span>kubectl label nodes node1 <span class="nv">hardware</span><span class="o">=</span>high-spec
kubectl label nodes node2 <span class="nv">hardware</span><span class="o">=</span><span class="nv">low</span><span class="o">=</span>spec
</pre></div></p>
<p>Second step: add a pod that uses those labels:
<div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nodehelloworld.example.com</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">helloworld</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">k8s-demo</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">daniel40392/k8s-demo</span>
  <span class="nt">ports</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3000</span>
<span class="nt">nodeSelector</span><span class="p">:</span>
  <span class="nt">hardware</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">high-spec</span>
</pre></div></p>
<h2 id="health-checks">Health Checks</h2>
<p>To detect and resolve problems with you app, you can run health checks</p>
<p>2 types of healthchecks:
* Running a command in the container periodically
* Periodic checks on a URL (HTTP)</p>
<div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nodehelloworld.example.com</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">helloworld</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">k8s-demo</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">daniel40392/k8s-demo</span>
  <span class="nt">ports</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3000</span>
  <span class="nt">livenessProbe</span><span class="p">:</span>
    <span class="nt">httpGet</span><span class="p">:</span>
      <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3000</span>
    <span class="nt">initialDelaySeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>
    <span class="nt">timeoutSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
</pre></div>

<p>You can describe pods to see the liveness in effect and success/failure counts</p>
<h2 id="readiness-probes">Readiness Probes</h2>
<ul>
<li>
<p>livenessProbes: indicates whether container is Running</p>
</li>
<li>
<p>readinessProbes: indicates whether container is ready to serve</p>
</li>
<li>make sure at startup the pod will onyl receive traffic when test succeeds</li>
<li>you can use them in conjunction</li>
</ul>
<h2 id="pod-state">Pod State</h2>
<ul>
<li>Pod Status <code>kubectl get pods</code> [Pending/Succeeded/Failed/Unknown]</li>
<li>Pod Condition <code>kubectl describe pod PODNAME</code> [PodScheduled/Ready/Initialized/Unschedulable/ContainersReady]</li>
<li>Container State <code>kubectl get pod &lt;podname&gt;</code>[Running/Terminated/Waiting]</li>
</ul>
<h2 id="secrets">Secrets</h2>
<ul>
<li>A way to distribute credentials, keys, passwords or data to pods</li>
</ul>
<p>Use in the following ways:</p>
<ul>
<li>Use secrets as env varaiables</li>
<li>Use secrets as a file in a pod</li>
<li>Uses volumes to be mounted in a container with files, can be used for dotenv files or your app can just read this file.</li>
<li>Use an external image to pull secrets from a private image registry</li>
</ul>
<p>To generate secrets using files:</p>
<div class="highlight"><pre><span></span><span class="nb">echo</span> -n <span class="s2">&quot;root&quot;</span> &gt; ./username.txt
<span class="nb">echo</span> -n <span class="s2">&quot;password&quot;</span> &gt; ./password.txt
kubectl create secret generic db-user-pass --from-file<span class="o">=</span>./username.txt --from-file<span class="o">=</span>./password.txt
</pre></div>

<p>Can also be an SSH key or SSL cert:
<div class="highlight"><pre><span></span>kubectl create secret generic ssl-certificate --from-file<span class="o">=</span>ssh-privatekey<span class="o">=</span>~/.sshid_rsa --ssl-cert<span class="o">=</span>mysslcert.crt
</pre></div></p>
<p>To generate secrets using yaml</p>
<div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">db-secret</span>
<span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Opaque</span>
<span class="nt">data</span><span class="p">:</span>
  <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">blergh</span> <span class="c1"># base64 encoded</span>
  <span class="nt">username</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">blergh2</span> <span class="c1"># base64 encoded</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="nb">echo</span> -n <span class="s2">&quot;blergh&quot;</span> <span class="p">|</span> base64
</pre></div>

<h3 id="using-secrets">Using Secrets</h3>
<p>Create a pod that exposes secrets as env variables:</p>
<div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nodehelloworld.example.com</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">helloworld</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">k8s-demo</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">daniel40392/k8s-demo</span>
  <span class="nt">ports</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3000</span>
  <span class="nt">env</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SECRET_USERNAME</span>
    <span class="nt">valueFrom</span><span class="p">:</span>
      <span class="nt">secretKeyRef</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">db-secret</span>
        <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">username</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SECRET_PASSWORD</span>
    <span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
</pre></div>

<p>Alternatively you can provide the secrets in a file:</p>
<div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nodehelloworld.example.com</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">helloworld</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">k8s-demo</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">daniel40392/k8s-demo</span>
  <span class="nt">ports</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3000</span>
  <span class="nt">volumeMounts</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">credvolume</span>
    <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/creds</span>
    <span class="nt">readOnly</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">volumes</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">credvolume</span>
  <span class="nt">secret</span><span class="p">:</span>
    <span class="nt">secretName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">db-secrets</span>
</pre></div>

<h3 id="web-ui">Web UI</h3>
<h3 id="start-dashboard">Start dashboard</h3>
<p>Create dashboard:
<div class="highlight"><pre><span></span>kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/master/src/deploy/recommended/kubernetes-dashboard.yaml
</pre></div></p>
<h3 id="create-user">Create user</h3>
<p>Create sample user (if using RBAC - on by default on new installs with kops / kubeadm):
<div class="highlight"><pre><span></span>kubectl create -f sample-user.yaml
</pre></div></p>
<h3 id="get-login-token">Get login token:</h3>
<div class="highlight"><pre><span></span>kubectl -n kube-system get secret | grep admin-user
kubectl -n kube-system describe secret admin-user-token-&lt;id displayed by previous command&gt;
</pre></div>

<h3 id="login-to-dashboard">Login to dashboard</h3>
<p>Go to <a href="http://api.yourdomain.com:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login">http://api.yourdomain.com:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login</a></p>
<p>Login: admin
Password: the password that is listed in ~/.kube/config (open file in editor and look for &ldquo;password: &hellip;&rdquo;</p>
<p>Choose for login token and enter the login token from the previous ste</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../docker/" title="Docker" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Docker
              </span>
            </div>
          </a>
        
        
          <a href="../../aws/aws/" title="AWS" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                AWS
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>