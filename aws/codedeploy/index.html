



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="https://lh3.googleusercontent.com/m2Zy-ujFWYyQUhg3uIuG_YDx00HB1v08cQ4CBJnd-v6LMPBpps3C4kvQriV0nObfI-I">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>CodeDeploy - Dans Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-47078105-6", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="cyan">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#aws-codedeploy" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Dans Docs" class="md-header-nav__button md-logo">
          
            <img src="https://lh3.googleusercontent.com/m2Zy-ujFWYyQUhg3uIuG_YDx00HB1v08cQ4CBJnd-v6LMPBpps3C4kvQriV0nObfI-I" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Dans Docs
            </span>
            <span class="md-header-nav__topic">
              
                CodeDeploy
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/dan-mcm/docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Dan's Docs
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../languages/python/" class="md-tabs__link">
          Languages
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../containerisation/docker/" class="md-tabs__link">
          Containerisation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../aws/" class="md-tabs__link md-tabs__link--active">
          AWS
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Dans Docs" class="md-nav__button md-logo">
      
        <img src="https://lh3.googleusercontent.com/m2Zy-ujFWYyQUhg3uIuG_YDx00HB1v08cQ4CBJnd-v6LMPBpps3C4kvQriV0nObfI-I" width="48" height="48">
      
    </a>
    Dans Docs
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/dan-mcm/docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Dan's Docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../publications/dev/" title="Publications" class="md-nav__link">
      Publications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Languages
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Languages
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../languages/python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../languages/javascript/" title="JavaScript" class="md-nav__link">
      JavaScript
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../languages/java/" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../languages/scala/" title="Scala" class="md-nav__link">
      Scala
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../languages/go/" title="Go" class="md-nav__link">
      Go
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Containerisation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Containerisation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../containerisation/docker/" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../containerisation/kubernetes/" title="Kubernetes" class="md-nav__link">
      Kubernetes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      AWS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        AWS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../aws/" title="AWS" class="md-nav__link">
      AWS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli/" title="CLI" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../iam/" title="IAM" class="md-nav__link">
      IAM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ec2/" title="EC2" class="md-nav__link">
      EC2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rds/" title="RDS" class="md-nav__link">
      RDS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../elb/" title="ELB" class="md-nav__link">
      ELB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../r53/" title="Route 53" class="md-nav__link">
      Route 53
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../elasticache/" title="Elasticache" class="md-nav__link">
      Elasticache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dynamo/" title="Dynamo DB" class="md-nav__link">
      Dynamo DB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dax/" title="Dax" class="md-nav__link">
      Dax
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kms/" title="KMS" class="md-nav__link">
      KMS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cloudwatch/" title="CloudWatch" class="md-nav__link">
      CloudWatch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../s3/" title="S3" class="md-nav__link">
      S3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cloudfront/" title="CloudFront" class="md-nav__link">
      CloudFront
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../serverless/" title="Serverless" class="md-nav__link">
      Serverless
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lambda/" title="Lambda" class="md-nav__link">
      Lambda
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api-gateway/" title="API Gateway" class="md-nav__link">
      API Gateway
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../step-functions/" title="Step Functions" class="md-nav__link">
      Step Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../x-ray/" title="X Ray" class="md-nav__link">
      X Ray
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sqs/" title="SQS" class="md-nav__link">
      SQS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sns/" title="SNS" class="md-nav__link">
      SNS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ses/" title="SES" class="md-nav__link">
      SES
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../elasticbeanstalk/" title="Elastic Beanstalk" class="md-nav__link">
      Elastic Beanstalk
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kinesis/" title="Kinesis" class="md-nav__link">
      Kinesis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ci-cd/" title="CI/CD" class="md-nav__link">
      CI/CD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../codecommit/" title="CodeCommit" class="md-nav__link">
      CodeCommit
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        CodeDeploy
      </label>
    
    <a href="./" title="CodeDeploy" class="md-nav__link md-nav__link--active">
      CodeDeploy
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#in-place" class="md-nav__link">
    In Place
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blue-green-deployment" class="md-nav__link">
    Blue / Green Deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terminology" class="md-nav__link">
    Terminology
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exam-tips" class="md-nav__link">
    Exam Tips
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practical-notes" class="md-nav__link">
    Practical Notes
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../codebuild/" title="CodeBuild" class="md-nav__link">
      CodeBuild
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../codepipeline/" title="CodePipeline" class="md-nav__link">
      CodePipeline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cloudformation/" title="CloudFormation" class="md-nav__link">
      CloudFormation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sam/" title="SAM" class="md-nav__link">
      SAM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extra-resources/" title="Study Resources" class="md-nav__link">
      Study Resources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#in-place" class="md-nav__link">
    In Place
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blue-green-deployment" class="md-nav__link">
    Blue / Green Deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terminology" class="md-nav__link">
    Terminology
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exam-tips" class="md-nav__link">
    Exam Tips
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practical-notes" class="md-nav__link">
    Practical Notes
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/dan-mcm/docs/edit/master/docs/aws/codedeploy.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="aws-codedeploy">AWS CodeDeploy</h1>
<ul>
<li>This is an automated deployment service which allows you to deploy your app code automatically to
EC2 instances, on-premise systems and Lambda functions.</li>
<li>Allows you to quickly release new features, avoid downtime during application deployments, and avoid
the risks associated with manual processes</li>
<li>Automatically scales with your infra and integrates with various CD/CD tools e.g. Jenkins, GitHub,
Atlassian, AWS CodePipeline as well as config management tools like Ansible, Puppet and Chef</li>
<li>Two deployment approaches available:<ul>
<li>In-Place and Blue/Green</li>
</ul>
</li>
</ul>
<h2 id="in-place">In Place</h2>
<ul>
<li>The application is stopped on each instance and the latest revision installed</li>
<li>The instance is out of service during this time and your capacity will be reduced</li>
<li>If the instances are behind a load balancer, you can configure the load balancer to stop sending
requests to the instances which are being upgraded.</li>
<li>Also known as a &lsquo;Rolling Update&rsquo;</li>
<li>It can only be used for EC2 and on-premise systems - not supported for Lambda</li>
<li>If you need to roll back changes, the previous version of the App will need to be re-deployed</li>
</ul>
<h2 id="blue-green-deployment">Blue / Green Deployment</h2>
<ul>
<li>New instances are provisioned at the latest revision is installed on the new instances.
Blue represents the active deployment, green is the new release</li>
<li>The new instances are registered with an ELB, traffic is then routed to the new instances and the original instances
eventually terminated</li>
<li>Advantages of Blue/Green are that the new instances are created ahead of time and the code released to production by
simply switching all traffic to the new servers</li>
<li>Switching back to the original environment is faster and more reliable and is just a case of routing the traffic back to
the original servers (as long as you haven&rsquo;t already terminated them)</li>
</ul>
<h2 id="terminology">Terminology</h2>
<ul>
<li>Deployment Group - A set of EC2 instances or Lambda functions to which a new revision of the software is to be deployed</li>
<li>Deployment - The process and components used to apply a new revision</li>
<li>Deployment Configuration - A set of deployment rules as well as success / failure conditions used during a deployment</li>
<li>AppSpec File - Defines the deployment actions you want AWS CodeDeploy to execute</li>
<li>Revision - Everything needed to deploy the new version: AppSpec file, application files, executables, config files</li>
<li>Application - Unique identifier for the application you want to deploy. To ensure the correct combination of
revision, deployment configuration and deployment group are referenced during a deployment</li>
</ul>
<h2 id="exam-tips">Exam Tips</h2>
<ul>
<li>AWS CodeDeploy is a fully managed automated deployment service and can be used as part of a Continuous Delivery/Deployment process</li>
<li>Remember types of deployment approach:<ul>
<li>In-Place/Rolling:<ul>
<li>Stop app on each host &amp; deploy latest code</li>
<li>EC2 and on premise systems only</li>
<li>Roll back requires redeploy of previous version of app</li>
</ul>
</li>
<li>Blue/Green:<ul>
<li>New instances provisioned and new app is deployed to those new instances</li>
<li>Traffic routed to new instances on your own schedule</li>
<li>Supported for EC2, on-premise &amp; lambda functions</li>
<li>Roll back is a traffic route back to the original instances</li>
<li>Blue is active deployment, green is new release</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="practical-notes">Practical Notes</h2>
<p>Setup of CodeDeploy on EC2:</p>
<div class="highlight"><pre><span></span><span class="c1">#Install CodeDeploy agent on your EC2 instance:</span>

sudo yum update
sudo yum install ruby
sudo yum install wget
<span class="nb">cd</span> /home/ec2-user
wget https://aws-codedeploy-eu-central-1.s3.amazonaws.com/latest/install
chmod +x ./install
sudo ./install auto
sudo service codedeploy-agent status


<span class="c1">#Create your application.zip and load it into CodeDeploy:</span>

aws deploy create-application --application-name mywebapp
aws deploy push --application-name mywebapp --s3-location s3://&lt;MY_BUCKET_NAME&gt;/webapp.zip --ignore-hidden-files
</pre></div>

<p>Sample AppSpec file</p>
<div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="nt">os</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">linux</span>
<span class="nt">files</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/index.html</span>
    <span class="nt">destination</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/www/html/</span>
<span class="nt">hooks</span><span class="p">:</span>
  <span class="nt">BeforeInstall</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">location</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">scripts/install_dependencies.sh</span> <span class="c1"># yum install -y httpd</span>
      <span class="nt">timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
      <span class="nt">runas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="p p-Indicator">-</span> <span class="nt">location</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">scripts/start_server.sh</span> <span class="c1"># service httpd start</span>
      <span class="nt">timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
      <span class="nt">runas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
  <span class="nt">ApplicationStop</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">location</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">scripts/stop_server.sh</span> <span class="c1"># service httpd stop</span>
      <span class="nt">timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
      <span class="nt">runas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
</pre></div>

<h1 id="advanced-codedeploy-appspec-file">Advanced CodeDeploy (AppSpec File)</h1>
<p>The AppSpec File is used to define the parameters that will be used for a CodeDeploy deployment.
The file structure depends on whether you are deploying to Lambda or ECS / On Premises.</p>
<p>For Lambda deployments, the AppSpec File may be written in YAML or JSON and contain the following fields:</p>
<ul>
<li>version: Reserved for future use - currently the only allowed value is 0.0</li>
<li>resources: The name and properties of the Lambda function to deploy</li>
<li>hooks: Specifies Lambda functions to run at set points in the deployment lifecycle to validate the deployment
e.g. validation tests to run before allowing traffic to be sent to your newly deployed instances</li>
</ul>
<h2 id="lambda-example">Lambda Example</h2>
<div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="nt">resources</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">myLambdaFunction</span><span class="p">:</span>
      <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::Lambda:Function</span>
      <span class="nt">Properties</span><span class="p">:</span>
        <span class="nt">Name</span><span class="p">:</span> <span class="s">&quot;myLambdaFunction&quot;</span>
        <span class="nt">Alias</span><span class="p">:</span> <span class="s">&quot;myLambdaFunctionAlias&quot;</span>
        <span class="nt">CurrentVersion</span><span class="p">:</span> <span class="s">&quot;1&quot;</span>
        <span class="nt">TargetVersion</span><span class="p">:</span> <span class="s">&quot;2&quot;</span>

<span class="nt">hooks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">BeforeAllowTraffic</span><span class="p">:</span> <span class="s">&quot;LambdaFunctionToValidateBeforeTrafficShift&quot;</span>
  <span class="p p-Indicator">-</span> <span class="nt">AfterAllowTraffic</span><span class="p">:</span> <span class="s">&quot;LambdaFunctionToValidateAfterTrafficShift&quot;</span>
</pre></div>

<h2 id="beforeallowtraffic">BeforeAllowTraffic</h2>
<p>Used to specify the tasks or functions you want to run before traffic is routed to the newly deployed Lambda function
e.g. test to validate that the function has been deployed correctly.</p>
<h2 id="afterallowtraffic">AfterAllowTraffic</h2>
<p>Used to specify the tasks or functions you want to run after the traffic has been routed to the newly deployed Lambda function.
e.g. test to validate that the function is accepting traffic correctly and behaving as expected.</p>
<h2 id="ec2-on-premises-example">EC2 / On Premises Example</h2>
<ul>
<li>version: Reserved for future use - currently the only allowed value is 0.0</li>
<li>os: The Operating System version you are using e.g. Linux, Windows</li>
<li>files: The location of any application files that need to be copies and where they should be copied to (source and destination folders)</li>
<li>hooks: Lifecycle event hooks allow you to specify scripts that need to run as set points in the deployment lifecycle e.g.
to unzip application files prior to deployment, run functional tests on the newly deployed application, and to
de-register and re-0register instances with a load balancer.</li>
</ul>
<p>For EC2 and On Premises deployments, the appspec.yml must be placed in the root of the directory of your revision - this is the
directory containing your application source code, otherwise the deployment will fail.</p>
<p>Typical setup looks like this:</p>
<p>mywebapp folder:
appspec.yml
/Scripts
/Config
/Source</p>
<h2 id="example-appspec-file-ec2">Example AppSpec File - EC2</h2>
<div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="nt">os</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">linux</span>
<span class="nt">files</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Config/config.txt</span>
    <span class="nt">destination</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/webapps/Config</span>
  <span class="p p-Indicator">-</span> <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Source</span>
    <span class="nt">destination</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/webapps/myApp</span>
<span class="nt">hooks</span><span class="p">:</span>
  <span class="nt">BeforeInstall</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">location</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Scripts/UnzipResourceBundle.sh</span>
    <span class="p p-Indicator">-</span> <span class="nt">location</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Scripts/UnzipResourceTests.sh</span>
  <span class="nt">AfterInstall</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">location</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Scripts/RunResourceTests.sh</span>
      <span class="nt">timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">180</span>
  <span class="nt">ApplicationStart</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">location</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Scripts/RunFunctionalTests.sh</span>
      <span class="nt">timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3600</span>
  <span class="nt">ValidateService</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">location</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Scripts/MonitorService.sh</span>
      <span class="nt">timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3600</span>
      <span class="nt">runas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">codedeployuser</span>
</pre></div>

<h2 id="supported-hooks-for-ec2-and-on-premises">Supported Hooks for EC2 and On Premises</h2>
<p>The &lsquo;run-order&rsquo; or hooks in a CodeDeploy deployment</p>
<p>When starting application:</p>
<ul>
<li>BeforeBlockTraffic - Run tasks on instances before they are deregistered from a load balancer</li>
<li>BlockTraffic - Deregister instances from a load balancer</li>
<li>AfterBlockTraffic - Run tasks on instances after they are Deregistered from a load balancer</li>
</ul>
<p>When upgrading any application:</p>
<ul>
<li>ApplicationStop - Gracefully stop the application in prep for deploying the new revision</li>
<li>DownloadBundle - The CodeDeploy agent copies the app revision files to a temporary location</li>
<li>BeforeInstall - Details of any pre-installation scripts e.g. backing up current version, decrypting files</li>
<li>Install - The CodeDeploy agent copies the app revision files from their temporary location to their current location</li>
<li>AfterInstall - Details of any post-installation scripts e.g. configuration tasks, change file permissions</li>
<li>ApplicaitonStart - Restarts any services that were stopped during ApplicationStop</li>
<li>ValidateService - Details of any tests to validate the service</li>
</ul>
<p>When re-registering your instances with load balancer:</p>
<ul>
<li>BeforeAllowTraffic - Run tasks on instances before they are registered with a load balancer</li>
<li>AllowTraffic - Register instances with a load balancer</li>
<li>AfterAllowTraffic - Run tasks on instances after they are registered with a load balancer</li>
</ul>
<h2 id="exam-tips-advanced-codedeploy">Exam Tips - Advanced CodeDeploy</h2>
<ul>
<li>The AppSpec file defines all the params needed for the deployment e.g. location of app files and pre/post deployment validation tests to run</li>
<li>For EC2/On Premises systems, the appspec.yml file must be placed in root directory of revision (the same folder that contains app code). Written in YAML</li>
<li>Lambda supports YAML or JSON</li>
<li>The run order for hooks in a CodeDeploy deployment:<ul>
<li>BeforeBlockTraffic -&gt; BlockTraffic -&gt; AfterBlockTraffic</li>
<li>ApplicationStop, BeforeInstall, Install, AfterInstall, ApplicationStart, ValidateService</li>
<li>BeforeAllowTraffic -&gt; AllowTraffic -&gt; AfterAllowTraffic</li>
</ul>
</li>
</ul>
<h2 id="docker-codebuild-lab">Docker &amp; CodeBuild Lab</h2>
<ul>
<li>Docker is an Open Source technology which allows you to create applications based on either Linux or Windows containers</li>
<li>A Container is a lightweight standalone executable software package which includes everything the software needs to run -
code, runtime environments, libraries, environment settings etc.</li>
<li>AWS provides Elastic Container Service as a fully managed clustered platform which allows you to run your Docker images in the cloud</li>
<li>AWS CodeBuild is a fully managed build service which runs a set of commands that you define e.g. compiles code, runs tests and produces 
artifacts that are ready to deploy</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../codecommit/" title="CodeCommit" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                CodeCommit
              </span>
            </div>
          </a>
        
        
          <a href="../codebuild/" title="CodeBuild" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                CodeBuild
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>